{
  "uid": "risk-engine-circuit",
  "title": "Risk Engine & Circuit-Breakers",
  "tags": ["trading", "risk", "circuit-breaker"],
  "timezone": "browser",
  "editable": true,
  "panels": [
    {
      "type": "stat",
      "title": "Circuit Breaker Status",
      "gridPos": {"x": 0, "y": 0, "w": 6, "h": 4},
      "datasource": "Prometheus",
      "targets": [{"expr": "velocitytrader_circuit_breaker_active", "refId": "A"}],
      "fieldConfig": {"defaults": {"mappings": [{"type": "value", "options": {"0": {"text": "ACTIVE", "color": "green"}, "1": {"text": "TRIPPED", "color": "red"}}}]}}
    },
    {
      "type": "stat",
      "title": "Trading Halt Status",
      "gridPos": {"x": 6, "y": 0, "w": 6, "h": 4},
      "datasource": "Prometheus",
      "targets": [{"expr": "velocitytrader_trading_halted", "refId": "A"}],
      "fieldConfig": {"defaults": {"mappings": [{"type": "value", "options": {"0": {"text": "TRADING", "color": "green"}, "1": {"text": "HALTED", "color": "red"}}}]}}
    },
    {
      "type": "gauge",
      "title": "Risk Budget Utilization",
      "gridPos": {"x": 12, "y": 0, "w": 6, "h": 4},
      "datasource": "Prometheus",
      "targets": [{"expr": "velocitytrader_risk_budget_used / velocitytrader_risk_budget_total * 100", "refId": "A"}],
      "fieldConfig": {"defaults": {"unit": "percent", "min": 0, "max": 100, "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 60}, {"color": "orange", "value": 80}, {"color": "red", "value": 95}]}}}
    },
    {
      "type": "stat",
      "title": "Breaker Trips Today",
      "gridPos": {"x": 18, "y": 0, "w": 6, "h": 4},
      "datasource": "Prometheus",
      "targets": [{"expr": "increase(velocitytrader_circuit_breaker_trips_total[24h])", "refId": "A"}],
      "fieldConfig": {"defaults": {"unit": "short", "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 1}, {"color": "red", "value": 3}]}}}
    },
    {
      "type": "timeseries",
      "title": "VPIN (Volume-Synchronized Probability of Informed Trading)",
      "gridPos": {"x": 0, "y": 4, "w": 12, "h": 6},
      "datasource": "Prometheus",
      "targets": [
        {"expr": "velocitytrader_vpin", "legendFormat": "VPIN", "refId": "V"},
        {"expr": "velocitytrader_vpin_threshold", "legendFormat": "Threshold", "refId": "T"}
      ],
      "fieldConfig": {"defaults": {"unit": "percent", "min": 0, "max": 100, "custom": {"lineWidth": 2, "fillOpacity": 10}}}
    },
    {
      "type": "timeseries",
      "title": "Spread Stress Index",
      "gridPos": {"x": 12, "y": 4, "w": 12, "h": 6},
      "datasource": "Prometheus",
      "targets": [
        {"expr": "velocitytrader_spread_stress_index", "legendFormat": "Spread Stress", "refId": "S"},
        {"expr": "velocitytrader_spread_stress_threshold", "legendFormat": "Threshold", "refId": "T"}
      ],
      "fieldConfig": {"defaults": {"unit": "none", "custom": {"lineWidth": 2, "fillOpacity": 10}, "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 2}, {"color": "red", "value": 3}]}}}
    },
    {
      "type": "timeseries",
      "title": "Daily Drawdown vs Limit",
      "gridPos": {"x": 0, "y": 10, "w": 8, "h": 6},
      "datasource": "Prometheus",
      "targets": [
        {"expr": "velocitytrader_daily_drawdown", "legendFormat": "Daily DD", "refId": "D"},
        {"expr": "velocitytrader_daily_drawdown_limit", "legendFormat": "Limit", "refId": "L"}
      ],
      "fieldConfig": {"defaults": {"unit": "percent", "custom": {"lineWidth": 2}}}
    },
    {
      "type": "timeseries",
      "title": "Position Limit Utilization",
      "gridPos": {"x": 8, "y": 10, "w": 8, "h": 6},
      "datasource": "Prometheus",
      "targets": [
        {"expr": "velocitytrader_position_count", "legendFormat": "Current Positions", "refId": "C"},
        {"expr": "velocitytrader_max_positions", "legendFormat": "Max Allowed", "refId": "M"}
      ],
      "fieldConfig": {"defaults": {"unit": "short", "custom": {"lineWidth": 2, "fillOpacity": 20}}}
    },
    {
      "type": "timeseries",
      "title": "Exposure per Symbol",
      "gridPos": {"x": 16, "y": 10, "w": 8, "h": 6},
      "datasource": "Prometheus",
      "targets": [
        {"expr": "velocitytrader_symbol_exposure", "legendFormat": "{{symbol}}", "refId": "E"}
      ],
      "fieldConfig": {"defaults": {"unit": "currencyUSD", "custom": {"stacking": {"mode": "normal"}}}}
    },
    {
      "type": "table",
      "title": "Risk Decisions Log",
      "gridPos": {"x": 0, "y": 16, "w": 12, "h": 6},
      "datasource": "Prometheus",
      "targets": [
        {"expr": "velocitytrader_risk_decision_total", "legendFormat": "{{decision}}", "refId": "A", "format": "table", "instant": true}
      ],
      "fieldConfig": {"defaults": {"custom": {"align": "left"}}},
      "options": {"showHeader": true}
    },
    {
      "type": "piechart",
      "title": "Risk Decision Distribution",
      "gridPos": {"x": 12, "y": 16, "w": 6, "h": 6},
      "datasource": "Prometheus",
      "targets": [
        {"expr": "velocitytrader_risk_decision_total{decision=\"APPROVE\"}", "legendFormat": "Approved", "refId": "A"},
        {"expr": "velocitytrader_risk_decision_total{decision=\"REDUCE_SIZE\"}", "legendFormat": "Size Reduced", "refId": "R"},
        {"expr": "velocitytrader_risk_decision_total{decision=\"REJECT\"}", "legendFormat": "Rejected", "refId": "J"},
        {"expr": "velocitytrader_risk_decision_total{decision=\"HALT\"}", "legendFormat": "Halted", "refId": "H"}
      ],
      "options": {"pieType": "donut", "legend": {"placement": "right"}}
    },
    {
      "type": "timeseries",
      "title": "Consecutive Losses Tracker",
      "gridPos": {"x": 18, "y": 16, "w": 6, "h": 6},
      "datasource": "Prometheus",
      "targets": [
        {"expr": "velocitytrader_consecutive_losses", "legendFormat": "Consecutive Losses", "refId": "L"},
        {"expr": "velocitytrader_consecutive_losses_limit", "legendFormat": "Limit", "refId": "T"}
      ],
      "fieldConfig": {"defaults": {"unit": "short", "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 3}, {"color": "red", "value": 5}]}}}
    },
    {
      "type": "stat",
      "title": "Daily Loss Limit",
      "gridPos": {"x": 0, "y": 22, "w": 4, "h": 3},
      "datasource": "Prometheus",
      "targets": [{"expr": "velocitytrader_daily_loss_limit", "refId": "A"}],
      "fieldConfig": {"defaults": {"unit": "currencyUSD"}}
    },
    {
      "type": "stat",
      "title": "Today's P&L",
      "gridPos": {"x": 4, "y": 22, "w": 4, "h": 3},
      "datasource": "Prometheus",
      "targets": [{"expr": "velocitytrader_daily_pnl", "refId": "A"}],
      "fieldConfig": {"defaults": {"unit": "currencyUSD", "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}, {"color": "green", "value": 0}]}}}
    },
    {
      "type": "stat",
      "title": "Max Position Size",
      "gridPos": {"x": 8, "y": 22, "w": 4, "h": 3},
      "datasource": "Prometheus",
      "targets": [{"expr": "velocitytrader_max_position_size", "refId": "A"}],
      "fieldConfig": {"defaults": {"unit": "short"}}
    },
    {
      "type": "stat",
      "title": "Risk Score",
      "gridPos": {"x": 12, "y": 22, "w": 4, "h": 3},
      "datasource": "Prometheus",
      "targets": [{"expr": "velocitytrader_risk_score", "refId": "A"}],
      "fieldConfig": {"defaults": {"unit": "none", "min": 0, "max": 100, "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 50}, {"color": "orange", "value": 70}, {"color": "red", "value": 85}]}}}
    },
    {
      "type": "stat",
      "title": "Order Rejects (1h)",
      "gridPos": {"x": 16, "y": 22, "w": 4, "h": 3},
      "datasource": "Prometheus",
      "targets": [{"expr": "increase(velocitytrader_orders_rejected_total[1h])", "refId": "A"}],
      "fieldConfig": {"defaults": {"unit": "short", "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 5}, {"color": "red", "value": 10}]}}}
    },
    {
      "type": "stat",
      "title": "Risk Engine Latency",
      "gridPos": {"x": 20, "y": 22, "w": 4, "h": 3},
      "datasource": "Prometheus",
      "targets": [{"expr": "velocitytrader_risk_engine_latency_ms", "refId": "A"}],
      "fieldConfig": {"defaults": {"unit": "ms", "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 10}, {"color": "red", "value": 50}]}}}
    }
  ],
  "schemaVersion": 38,
  "version": 1,
  "refresh": "5s"
}
